!function(){var t=function(t){t.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home",resolve:{user:["User",function(t){return t.getUser()}]}}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).otherwise({redirectTo:"/"})},e=function(t,e,o){var r=window.localStorage.getItem(o.LOGIN_TOKEN);"true"===r&&(t.isLoggedIn=!0),t.$on("$locationChangeStart",function(r,n,i){var a=window.localStorage.getItem(o.LOGIN_TOKEN);t.loading=!0,"true"!==a&&e.path()!==o.ROUTES.LOGIN?e.path(o.ROUTES.LOGIN):"true"===a&&e.path()===o.ROUTES.LOGIN&&e.path("/")}),t.$on("$locationChangeSuccess",function(e,o,r){t.loading=!1})};t.$inject=["$routeProvider"],angular.module("gate",["ngRoute","gate.Controllers","gate.Services","gate.Directives"]).config(t).constant("gateConfig",{LOGIN_TOKEN:"gate.authenticated",SERVICE_DURATION:1250,SERVICE_URL:"authenticate.json",ROUTES:{HOME:"/home",LOGIN:"/login"}}).run(["$rootScope","$location","gateConfig",e]);var o=function(t,e,o,r,n,i){var a=this,l=function(e){t.loading=!0,n.logIn(e).then(function(t){a.invalidCredentials=!1,i.setUser(t),o.path("/home")})["catch"](function(e){a.invalidCredentials=!0,t.loading=!1})};a.logIn=l},r=function(t,e,o,r,n){var i=this;i.user=n},n=function(t,e){var o=this;o.logOut=e.logOut};angular.module("gate.Controllers",["gate.Services"]).controller("LoginCtrl",["$rootScope","$scope","$location","$routeParams","Auth","User",o]).controller("HomeCtrl",["$scope","$location","$routeParams","User","user",r]).controller("NavCtrl",["$scope","Auth",n]);var i=function(t,e,o,r){var n=this,i=function(e){var o={email:n.ui.email.val(),password:n.ui.password.val()};t.submit(o)};n.ui={submit:e.find("[type=submit]"),email:e.find("[type=text]"),password:e.find("[type=password]")},n.ui.submit.on("click",i)},a=function(t){return{replace:!0,restrict:"AEC",scope:{submit:"=onSubmit",validationError:"=validationVariable"},templateUrl:"directives/loginForm.html",transclude:!1,link:i}};angular.module("gate.Directives",[]).directive("loginForm",["$rootScope",a]);var l=function(t,e,o,r,n,i){var a=function(t){return t.email===this.email&&t.password===this.password};return{logIn:function(e){return t.get(n.SERVICE_URL).then(function(t){var r=t.data.users.filter(a,e)[0];return o(function(t,o){setTimeout(function(){r?t(r):o("INVALID CREDENTIALS:"+e)},n.SERVICE_DURATION)})})},logOut:function(){for(var t in window.localStorage)t.indexOf("gate")!==-1&&delete window.localStorage[t];e.isLoggedIn=!1,r.path(n.ROUTES.LOGIN)}}},s=function(t){var e;return{getUser:function(){e={};for(var t in window.localStorage)t.indexOf("gate.user.")!==-1&&(e[t.substr(10)]=window.localStorage[t]);return e},setUser:function(e){window.localStorage.setItem("gate.authenticated",!0),t.isLoggedIn=!0;for(var o in e)"password"!==o&&window.localStorage.setItem("gate.user."+o,e[o]);return e}}};angular.module("gate.Services",[]).factory("Auth",["$http","$rootScope","$q","$location","gateConfig","User",l]).factory("User",["$rootScope",s]),angular.module("gate").run(["$templateCache",function(t){t.put("directives/loginForm.html",'<form class="gate-login__form">Email:<input type="text" class="gate-login__form-email"/><br/>Password:<input type="password" class="gate-login__form-password"/><br/><input type="submit" value="Log in" class="gate-login__form-submit"/><div ng-show="validationError" class="gate-login__form-error tx--red">Eeek! Invalid credentials I\'m afraid</div></form>'),t.put("views/home.html","<div><h1>Welcome back {{ home.user.firstName }}!</h1></div>"),t.put("views/login.html",'<div><login-form on-submit="login.logIn" validation-variable="login.invalidCredentials"></login-form></div>')}])}();